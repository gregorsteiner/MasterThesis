---
title: "Extreme Heat Events and Fatal Car Accidents"
author: "Gregor Steiner"
date: "`r format(Sys.Date(), format = '%m/%d/%Y')`"
output:
  md_document:
    variant: markdown_github
bibliography: references.bib  
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,
                      warning = FALSE,
                      message = FALSE,
                      fig.pos = "center",
                      fig.width = 8,
                      fig.height = 6)
```




```{r}
# preliminaries
library(data.table)

```

## Extreme Heat Events and Fatal Car Accidents

In my master thesis I want to explore the causal effect of extreme heat events on fatal car accidents.

Using data provided by the Daily Global Historical Climatology Network [@Menne_2012], I identify extreme heat events in the historical temperature time series. Historical weather data is available for about 1200 measurement stations in the US. Based on the latitude and longitude coordinates I assign each station to the county it belongs to. In case there is more than one station per county, I take the mean among those.

Following the National Climate Data Center (NCDC), I define an extreme heat event as two or more consecutive days in which the minimum temperature exceeds the 85th percentile of July and August minimum temperatures [@Habeeb_2015]. Below you can see the historical temperature time series for a few selected counties with such extreme heat events shaded in red.


```{r}
# read data
data <- readRDS("DataCombined.RDS")


# Define counties of interest
counties <- c("JACKSON COUNTY, OREGON", "ONTARIO COUNTY, NEW YORK",
             "ORANGE COUNTY, CALIFORNIA", "YORK COUNTY, SOUTH CAROLINA",
             "PIMA COUNTY, ARIZONA", "CHAMPAIGN COUNTY, ILLINOIS")


# Make plots
par(mfrow = c(round(length(counties) / 2), 2),
    mar = c(2, 4, 2, 1))
invisible(lapply(counties, function(x){
  
  dat <- data[data$StateCounty == x, ]
  
  # Indicate Heatwaves
  # compute threshold (85th percentile of july and august temperatures)
  bool.jul.aug <- format(dat$DATE, "%m") %in% c("07", "08") 
  threshhold <- quantile(dat[bool.jul.aug, "TMIN"], 0.85, na.rm = TRUE)
  
  # Mark as heatwave all consecutive days that exceed the threshhold
  bool <- dat[, "TMIN"] > threshhold
  bool <- ifelse(is.na(bool), FALSE, bool)
  dat$ExtremeHeatEvent <- 0
  
  for (i in 1:(nrow(dat)-1)) {
    if(all(bool[i:(i+1)])){
      dat[i:(i+1), "ExtremeHeatEvent"] <- 1
    }
  }
  
  # Get dates with extreme heat
  heatdates <- unlist(dat[dat$ExtremeHeatEvent == 1, "DATE"])
  
  # make graph
  plot(dat$DATE, dat$TMIN, type = "n",
       ylab = "Temperature in Â°C", xlab = "", main = x)
  
  abline(v = heatdates, col = rgb(1, 0, 0, 0.3), lwd = 1)
  lines(dat$DATE, dat$TMIN, lwd = 1)
  
  
}))



```





## References



